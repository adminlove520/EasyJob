# 火山引擎大模型流式语音识别服务

## 概述

本项目已集成火山引擎大模型流式语音识别服务，提供高准确率的实时语音识别能力。

## 配置要求

### 环境变量

在 `.env` 文件中配置以下变量：

```env
# 火山引擎大模型流式语音识别配置
VOLCENGINE_APP_KEY=your_volcengine_app_key
VOLCENGINE_ACCESS_KEY=your_volcengine_access_key
VOLCENGINE_ASR_RESOURCE_ID=volc.bigasr.sauc.duration
```

### 获取API密钥

1. 访问 [火山引擎控制台](https://console.volcengine.com/)
2. 注册并登录账户
3. 进入语音技术服务页面
4. 创建应用获取 `APP_KEY` 和 `ACCESS_KEY`
5. 确保账户有大模型流式语音识别服务权限

## 服务特性

### 支持的模式

- **双向流式模式**：实时双向通信，低延迟
- **流式输入模式**：高准确率识别
- **优化版本**：性能优化的双向流式模式

### 音频格式支持

- **格式**：PCM、WAV、OGG
- **采样率**：16kHz
- **声道数**：单声道（1）
- **位深度**：16位
- **编码**：raw、opus

### 功能特性

- 实时流式识别
- 语义分句
- 标点符号自动添加
- 文本规范化（ITN）
- 语义顺滑
- 敏感词过滤
- 热词支持

## 测试和验证

### 配置测试

运行配置测试脚本：

```bash
python test_asr_config.py
```

### 服务测试

运行完整服务测试：

```bash
python test_asr.py
```

### 前端测试

在浏览器中打开测试页面：

```bash
# 启动后端服务
uvicorn app.main:app --reload

# 在浏览器中打开
open test_asr_frontend.html
```

## API端点

### 配置获取

```
POST /api/v1/asr/config
```

获取ASR服务配置信息。

### 语音识别

```
POST /api/v1/asr/recognize
```

一次性语音识别。

### 面试语音识别

```
POST /api/v1/asr/interview-recognition
```

针对面试场景优化的语音识别。

### 服务状态

```
GET /api/v1/asr/status
```

获取服务状态和配置信息。

### 实时WebSocket

```
WebSocket /api/v1/asr/realtime/{client_id}
```

实时语音识别WebSocket连接。

## 面试系统集成

### 语音输入模式

在面试页面中，用户可以选择：

1. **文字输入**：传统的文本输入方式
2. **语音输入**：使用语音识别进行回答

### 语音控制

- 系统自动识别并填充回答

### 优化配置

面试场景使用特殊优化配置：

- 启用语义顺滑（DDC）
- 快速判停（500ms）
- 提高实时性响应

## 错误处理

### 常见错误

1. **配置不完整**
   - 检查环境变量设置
   - 确认API密钥正确

2. **网络连接失败**
   - 检查网络连接
   - 确认防火墙设置
   - 尝试使用VPN

3. **权限不足**
   - 检查API密钥权限
   - 确认服务订阅状态

4. **音频格式错误**
   - 确认音频格式符合要求
   - 检查采样率和声道数

### 调试日志

系统会记录详细的调试信息，包括：

- WebSocket连接状态
- API请求和响应
- 音频数据处理
- 识别结果详情

## 性能优化

### 音频分包

- 建议音频块大小：100-200ms
- 双向流式模式：200ms最优
- 避免过大或过小的音频块

### 连接管理

- 使用连接池管理WebSocket连接
- 及时关闭不用的连接
- 处理连接异常和重连

### 结果缓存

- 缓存识别结果避免重复处理
- 使用序列号管理音频顺序
- 实现增量结果更新

## 监控和维护

### 服务监控

- 监控WebSocket连接数
- 跟踪识别成功率
- 记录响应时间

### 日志管理

- 使用结构化日志
- 记录关键操作
- 便于问题排查

### 性能指标

- RTF（实时因子）
- 首字延迟
- 尾字延迟
- 准确率统计

## 最佳实践

1. **音频质量**
   - 使用清晰的音频源
   - 避免环境噪音
   - 确保音频格式正确

2. **网络稳定**
   - 使用稳定的网络连接
   - 实现连接重试机制
   - 处理网络异常

3. **错误处理**
   - 实现完整的错误处理
   - 提供用户友好的错误信息
   - 记录详细的错误日志

4. **用户体验**
   - 提供实时反馈
   - 显示识别进度
   - 支持取消和重试

## 技术支持

如果遇到问题，请：

1. 查看详细的错误日志
2. 运行测试脚本验证配置
3. 检查火山引擎服务状态
4. 联系技术支持团队

## 更新日志

- **v1.0.0** - 初始实现火山引擎大模型流式语音识别
- **v1.1.0** - 添加面试场景优化配置
- **v1.2.0** - 完善错误处理和测试功能